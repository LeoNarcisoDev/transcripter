<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Transcrição ao Vivo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container mt-5 text-center">
    <h2 class="mb-4 text-primary">🎤 Transcrição de Fala ao Vivo</h2>

    <div class="mb-3">
        <button id="btn-start" class="btn btn-success">🟢 Iniciar</button>
        <button id="btn-stop" class="btn btn-danger" disabled>⏹ Parar</button>
    </div>

    <div class="card p-3">
        <h5 class="text-success">📝 Transcrição:</h5>
        <div id="resultado" class="text-dark mt-2" style="min-height: 100px;"></div>
    </div>

    <a href="/" class="btn btn-secondary mt-4">⬅️ Voltar</a>
</div>

<script>
    let escutando = false;
    let intervalo = null;

    const btnStart = document.getElementById('btn-start');
    const btnStop = document.getElementById('btn-stop');
    const resultado = document.getElementById('resultado');

    btnStart.addEventListener('click', () => {
        escutando = true;
        btnStart.disabled = true;
        btnStop.disabled = false;
        resultado.innerText = "🎙️ Aguardando sua fala...";

        intervalo = setInterval(() => {
            if (!escutando) return;
            fetch('/transcrever', { method: 'POST' })
                .then(res => res.json())
                .then(data => {
                    if (data.texto) {
                        resultado.innerText += "\n" + data.texto;
                    }
                });
        }, 6000); // ou 5000ms para cada escuta (~5s)
    });

    btnStop.addEventListener('click', () => {
        escutando = false;
        btnStart.disabled = false;
        btnStop.disabled = true;
        clearInterval(intervalo);
    });
</script>
</body>
</html>
